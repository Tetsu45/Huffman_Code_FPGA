

1. Required Code Modification 

Add inside shift_reg:

// Helper function: reverse bit order within each nibble
function [3:0] reverse_bits(input [3:0] data);
    reverse_bits = {data[0], data[1], data[2], data[3]};
endfunction


Then change the input masking line:

in_masked = reverse_bits(in_bits) & ((1 << in_len) - 1);

This does not require a change in other modules 

2. // Add to shift_reg.v
reg [3:0] in_bits_reversed;
integer i;

always @(*) begin
    for (i = 0; i < 4; i = i + 1) begin
        in_bits_reversed[i] = in_bits[3 - i];
    end
end

// Use in_bits_reversed instead of in_bits in loading logic
if (load_bits && ...) begin
    in_masked = in_bits_reversed & ((1 << in_len) - 1);
    // ... rest of loading logic
end
