

1. Required Code Modification 

Add inside shift_reg:

// Helper function: reverse bit order within each nibble
function [3:0] reverse_bits(input [3:0] data);
    reverse_bits = {data[0], data[1], data[2], data[3]};
endfunction


Then change the input masking line:

in_masked = reverse_bits(in_bits) & ((1 << in_len) - 1);

This does not require a change in other modules 
